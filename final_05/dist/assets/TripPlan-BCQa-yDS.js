import{r,w as z,o as R,b as E,c as I,s as D,x as W,y as q,z as G,S as C,l as H,A as J,e as l,i as N,m as O,v as V,F,p as Q,j as X,q as Y,B as Z,t as $}from"./index-BWaCr9_N.js";import{_ as K}from"./VSelect-OShSSaR7.js";const ee={id:"map"},te={__name:"VPlanMap",props:{stations:Array,selectStation:Object},setup(j){var v,x;const g=r([]),c=r([]),f=r([]),i=r([]),d=r([]),m=j;z(()=>m.selectStation.value,()=>{var s=new kakao.maps.LatLng(m.selectStation.latitude,m.selectStation.longitude);v.panTo(s)},{deep:!0}),R(()=>{if(window.kakao&&window.kakao.maps)w();else{const s=document.createElement("script");s.src="//dapi.kakao.com/v2/maps/sdk.js?autoload=false&appkey=d234049397979f6f3e7cf5e308e8acea&libraries=services,clusterer",s.onload=()=>kakao.maps.load(()=>w()),document.head.appendChild(s)}}),z(()=>m.stations.value,()=>{g.value=[],m.stations.forEach(s=>{let t={};t.latlng=new kakao.maps.LatLng(s.latitude,s.longitude),t.title=s.title,t.contentId=s.contentId,t.contentTypeId=s.contentTypeId,t.firstImage=s.firstImage,t.addr1=s.addr1,t.addr2=s.addr2,t.zipcode=s.zipcode,t.tel=s.tel,t.overview=s.overview,g.value.push(t)}),S()},{deep:!0});const w=()=>{const s=document.getElementById("map"),t={center:new kakao.maps.LatLng(33.450701,126.570667),level:7};v=new kakao.maps.Map(s,t),x=new kakao.maps.MarkerClusterer({map:v,averageCenter:!1,minLevel:7})},S=()=>{B(),M(x);const s=new kakao.maps.Size(25,25);c.value=[],f.value=[],g.value.forEach(e=>{var a="/src/assets/img_marker";a+=e.contentTypeId,a+=".png";const h=new kakao.maps.MarkerImage(a,s),o=new kakao.maps.Marker({map:v,position:e.latlng,title:e.title,clickable:!0,image:h});var u=e.firstImage;u==""&&(u="/src/assets/bg-white.png");var k=`        <div class="mb-10" style="padding: 5px;">           <div> ${e.title} </div>           <img src="${u}" class="m-auto" width="150px" height="auto"/>        <div>${e.addr1}</div> </div>`,b=new kakao.maps.InfoWindow({content:k});f.value.push(b),c.value.push(o)});for(let e=0;e<g.value.length;e++)kakao.maps.event.addListener(c.value[e],"mouseover",function(){f.value[e].open(v,c.value[e])}),kakao.maps.event.addListener(c.value[e],"mouseout",function(){f.value[e].close()}),kakao.maps.event.addListener(c.value[e],"click",function(){f.value[e].close();let a=c.value[e].getPosition(),h=new kakao.maps.MarkerImage("/src/assets/plane.png",s),o=new kakao.maps.Marker({map:v,position:a,title:a.title,image:h});i.value.push(o),d.value.push(a),o.setMap(v),A(g.value[e].title,g.value[e].contentId,o),y()});x.addMarkers(c.value);const t=g.value.reduce((e,a)=>e.extend(a.latlng),new kakao.maps.LatLngBounds);v.setBounds(t)},B=()=>{c.value.length>0&&c.value.forEach(s=>s.setMap(null))};function M(s){s.clear()}let A=function(s,t,e){let a=document.getElementById("plan-list"),h=document.createElement("div");h.setAttribute("class","row mb-1 plan-list-item border rounded-md p-2");let o=document.createElement("div");o.setAttribute("class","col-md-10 flex place-items-center");let u=document.createElement("input");u.setAttribute("name","plan-list-item"),u.setAttribute("type","text"),u.setAttribute("class","ml-2 form-control outline-none"),u.setAttribute("value",s),u.setAttribute("data-content-id",t),u.setAttribute("readonly","readonly");let k=document.createElement("button");k.setAttribute("type","button"),k.setAttribute("class","rounded-xl bg-red-500 px-2 py-1 text-base font-medium text-white transition duration-200 hover:bg-red-400 active:bg-red-600"),k.appendChild(document.createTextNode("삭제")),k.addEventListener("click",function(){let n=this.parentNode;a.removeChild(n.parentNode);for(var p=0;p<i.value.length;p++)D(i.value[p])===e&&(i.value[p].setMap(null),i.value.splice(p,1),d.value.splice(p,1),p--);y()});let b=document.createElement("button");b.setAttribute("type","button"),b.setAttribute("class","ml-auto mr-2 rounded-xl bg-white px-2 py-1 text-base font-medium text-indigo-600  transition duration-200 hover:text-white hover:bg-indigo-500 active:bg-indigo-600 border border-indigo-600"),b.setAttribute("style","transform: rotate(90deg)"),b.appendChild(document.createTextNode("<")),b.addEventListener("click",function(){for(var n=0;n<i.value.length;n++)if(D(i.value[n])===e){if(n==0)return;let p=this.parentNode.parentNode;document.getElementById("plan-list").insertBefore(p,p.previousSibling);let T=i.value[n-1];i.value[n-1]=i.value[n],i.value[n]=T;let P=d.value[n-1];d.value[n-1]=d.value[n],d.value[n]=P;break}y()});let L=document.createElement("button");L.setAttribute("type","button"),L.setAttribute("class","mr-2 rounded-xl bg-white px-2 py-1 text-base font-medium text-indigo-600 transition duration-200 hover:text-white hover:bg-indigo-500 active:bg-indigo-600 border border-indigo-600"),L.setAttribute("style","transform: rotate(90deg)"),L.appendChild(document.createTextNode(">")),L.addEventListener("click",function(){for(var n=0;n<i.value.length;n++)if(D(i.value[n])===e){if(n==i.value.length-1)return;let p=this.parentNode.parentNode.nextSibling;document.getElementById("plan-list").insertBefore(p,p.previousSibling);let T=i.value[n+1];i.value[n+1]=i.value[n],i.value[n]=T;let P=d.value[n+1];d.value[n+1]=d.value[n],d.value[n]=P;break}y()}),o.appendChild(u),o.appendChild(b),o.appendChild(L),o.appendChild(k),h.appendChild(o),a.appendChild(h)};var _=null;function y(){_!=null&&_.setMap(null);const s=r([]);for(let t=0;t<d.value.length;t++)s.value.push(d.value[t]);_=new kakao.maps.Polyline({path:s.value,strokeWeight:5,strokeColor:"#2D64F5",strokeOpacity:.7,strokeStyle:"solid"}),_.setMap(v)}return(s,t)=>(E(),I("div",ee))}},ae=l("div",{class:"my-5 text-center font-semibold text-xl"},"여행 계획",-1),se={class:"grid grid-cols-4"},le={class:"col-span-3"},ne={class:"fluid-container text-center mt-3 mr-[100px] ml-auto w-9/12"},oe={class:"flex items-center justify-center mb-10"},ie={class:"mx-auto"},re={class:"flex"},de={class:"flex items-center max-w-md mx-auto bg-white rounded-lg","x-data":"{ search: '' }"},ue={class:"w-full"},ce=l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),pe=[ce],ve={key:0,class:"my-5"},me={key:1,class:"bg-white my-5"},he={class:"overflow-x-auto border-x border-t scrollbar",style:{width:"100%",height:"500px",overflow:"auto"}},ge={class:"table-auto w-full"},fe=l("thead",{class:"border-b"},[l("tr",{class:"bg-emerald-500 text-white"},[l("th",{class:"text-center p-4 font-medium"},"대표이미지"),l("th",{class:"text-center p-4 font-medium"},"관광지명"),l("th",{class:"text-center p-4 font-medium"},"주소")])],-1),be={class:"overflow-y-scroll w-full"},ke=["onClick"],xe={class:"p-2",style:{width:"100px"}},we=["src"],_e={class:"p-3",style:{width:"200px"}},ye={class:"p-3",style:{width:"300px"}},Le={class:"col-span-1 mr-auto ml-10"},Ce={class:"mr-14 mt-5"},Ee=l("button",{class:"bg-white text-emerald-600 font-semibold py-2 px-4 border border-emerald-600 rounded-md shadow-md hover:bg-emerald-600 hover:text-white focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-opacity-50",id:"tripPlanSaveBtn"}," 저장하기 ",-1),Ie={class:"my-5"},Se={for:"date"},Be=l("div",{id:"plan-list",class:"mt-3"},null,-1),Te={__name:"TripPlan",setup(j){const v=W(),{userInfo:x}=q(v),g=G(),c=r([]),f=r([]),i=r({}),d=r([{text:"관광지 유형",value:0},{text:"관광지",value:12},{text:"문화시설",value:14},{text:"축제공연행사",value:15},{text:"여행코스",value:25},{text:"레포츠",value:28},{text:"숙박",value:32},{text:"쇼핑",value:38},{text:"음식점",value:39}]),m=r({sidoCode:0,contentTypeId:0,keyword:""}),w=r(null),S=r(null);R(()=>{x.value.userId||(C.fire("로그인이 필요한 페이지입니다!"),g.push({name:"user-login"})),B(),document.getElementById("tripPlanSaveBtn").addEventListener("click",function(){let e=document.getElementsByName("plan-list-item");const a=r([]);for(let o=0;o<e.length;o++){let u=e[o].getAttribute("data-content-id");console.log(u),a.value.push(u)}const h=r({userId:x.value.userId,startDate:w.value,endDate:S.value,planList:a.value,comment:""});C.fire({title:"여행 제목을 입력하세요",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"확인",cancelButtonText:"취소",showLoaderOnConfirm:!0,preConfirm:async o=>(o?h.value.comment=o:C.showValidationMessage("여행 제목을 입력해야 합니다."),o),allowOutsideClick:()=>!C.isLoading()}).then(o=>{o.isConfirmed&&o.value&&s(h.value)})})});const B=()=>{H(({data:t})=>{let e=[];e.push({text:"시도선택",value:""}),t.forEach(a=>{e.push({text:a.sidoName,value:a.sidoCode})}),c.value=e},t=>{console.log(t)})},M=t=>{m.value.sidoCode=t},A=t=>{m.value.contentTypeId=t},_=()=>{Y(m.value,({data:t})=>{f.value=t},t=>{console.log(t)})},y=t=>{i.value=t},s=t=>{J(t,e=>{let a=e.data;e.status===Z.OK?(a="계획을 저장했습니다.",C.fire({text:a,icon:"success"}),g.push({name:"trip-planList"})):C.fire({icon:"error",text:a})},e=>{console.error(e)})};return(t,e)=>(E(),I(F,null,[ae,l("div",se,[l("div",le,[l("div",ne,[l("div",oe,[l("div",ie,[l("form",re,[N(K,{selectOption:c.value,onOnKeySelect:M},null,8,["selectOption"]),N(K,{selectOption:d.value,onOnKeySelect:A},null,8,["selectOption"]),l("div",de,[l("div",ue,[O(l("input",{type:"search",class:"w-full px-4 py-1 text-gray-800 rounded-full focus:outline-none","onUpdate:modelValue":e[0]||(e[0]=a=>m.value.keyword=a),placeholder:"search","x-model":"search"},null,512),[[V,m.value.keyword]])]),l("div",null,[l("button",{class:"flex items-center bg-emerald-500 justify-center w-12 h-12 text-white rounded-r-lg",type:"button",onClick:_},pe)])])])])]),N(te,{stations:f.value,selectStation:i.value},null,8,["stations","selectStation"]),f.value.length===0?(E(),I("div",ve)):(E(),I("div",me,[l("div",he,[l("table",ge,[fe,l("tbody",be,[(E(!0),I(F,null,Q(f.value,a=>(E(),I("tr",{class:"text-center border-b hover:bg-gray-50",key:a.contentId,onClick:h=>y(a)},[l("td",xe,[l("img",{src:a.firstImage},null,8,we)]),l("td",_e,$(a.title),1),l("td",ye,$(a.addr1)+" "+$(a.addr2),1)],8,ke))),128))])])])]))])]),l("div",Le,[l("div",Ce,[Ee,l("div",Ie,[l("label",Se,[O(l("input",{type:"date",id:"startDate","onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a)},null,512),[[V,w.value]]),X(" ~ "),O(l("input",{type:"date",id:"endDate","onUpdate:modelValue":e[2]||(e[2]=a=>S.value=a)},null,512),[[V,S.value]])])]),Be])])])],64))}};export{Te as default};
