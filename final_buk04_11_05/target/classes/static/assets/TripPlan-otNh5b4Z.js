import{r as d,w as z,o as U,b as C,c as I,s as D,x as W,S as L,l as q,y as G,e as a,i as N,m as O,v as V,F,p as H,j as J,q as Q,z as X,t as $}from"./index-CmhezA2U.js";import{_ as K}from"./VSelect-DXTZcpdn.js";const Y={id:"map"},Z={__name:"VPlanMap",props:{stations:Array,selectStation:Object},setup(j){var p,w;const v=d([]),u=d([]),k=d([]),s=d([]),r=d([]),f=j;z(()=>f.selectStation.value,()=>{var e=new kakao.maps.LatLng(f.selectStation.latitude,f.selectStation.longitude);p.panTo(e)},{deep:!0}),U(()=>{if(window.kakao&&window.kakao.maps)E();else{const e=document.createElement("script");e.src="//dapi.kakao.com/v2/maps/sdk.js?autoload=false&appkey=d234049397979f6f3e7cf5e308e8acea&libraries=services,clusterer",e.onload=()=>kakao.maps.load(()=>E()),document.head.appendChild(e)}}),z(()=>f.stations.value,()=>{v.value=[],f.stations.forEach(e=>{let t={};t.latlng=new kakao.maps.LatLng(e.latitude,e.longitude),t.title=e.title,t.contentId=e.contentId,t.contentTypeId=e.contentTypeId,t.firstImage=e.firstImage,t.addr1=e.addr1,t.addr2=e.addr2,t.zipcode=e.zipcode,t.tel=e.tel,t.overview=e.overview,v.value.push(t)}),S()},{deep:!0});const E=()=>{const e=document.getElementById("map"),t={center:new kakao.maps.LatLng(33.450701,126.570667),level:7};p=new kakao.maps.Map(e,t),w=new kakao.maps.MarkerClusterer({map:p,averageCenter:!1,minLevel:7})},S=()=>{B(),M(w);const e=new kakao.maps.Size(25,25);u.value=[],k.value=[],v.value.forEach(l=>{var o="/src/assets/img_marker";o+=l.contentTypeId,o+=".png";const g=new kakao.maps.MarkerImage(o,e),m=new kakao.maps.Marker({map:p,position:l.latlng,title:l.title,clickable:!0,image:g});var h=l.firstImage;h==""&&(h="/src/assets/bg-white.png");var x=`        <div class="mb-10" style="padding: 5px;">           <div> ${l.title} </div>           <img src="${h}" class="m-auto" width="150px" height="auto"/>        <div>${l.addr1}</div> </div>`,b=new kakao.maps.InfoWindow({content:x});k.value.push(b),u.value.push(m)});for(let l=0;l<v.value.length;l++)kakao.maps.event.addListener(u.value[l],"mouseover",function(){k.value[l].open(p,u.value[l])}),kakao.maps.event.addListener(u.value[l],"mouseout",function(){k.value[l].close()}),kakao.maps.event.addListener(u.value[l],"click",function(){k.value[l].close();let o=u.value[l].getPosition(),g=new kakao.maps.MarkerImage("/src/assets/plane.png",e),m=new kakao.maps.Marker({map:p,position:o,title:o.title,image:g});s.value.push(m),r.value.push(o),m.setMap(p),A(v.value[l].title,v.value[l].contentId,m),i()});w.addMarkers(u.value);const t=v.value.reduce((l,o)=>l.extend(o.latlng),new kakao.maps.LatLngBounds);p.setBounds(t)},B=()=>{u.value.length>0&&u.value.forEach(e=>e.setMap(null))};function M(e){e.clear()}let A=function(e,t,l){let o=document.getElementById("plan-list"),g=document.createElement("div");g.setAttribute("class","row mb-1 plan-list-item border rounded-md p-2");let m=document.createElement("div");m.setAttribute("class","col-md-10 flex place-items-center");let h=document.createElement("input");h.setAttribute("name","plan-list-item"),h.setAttribute("type","text"),h.setAttribute("class","ml-2 form-control outline-none"),h.setAttribute("value",e),h.setAttribute("data-content-id",t),h.setAttribute("readonly","readonly");let x=document.createElement("button");x.setAttribute("type","button"),x.setAttribute("class","rounded-xl bg-red-500 px-2 py-1 text-base font-medium text-white transition duration-200 hover:bg-red-400 active:bg-red-600"),x.appendChild(document.createTextNode("삭제")),x.addEventListener("click",function(){let n=this.parentNode;o.removeChild(n.parentNode);for(var c=0;c<s.value.length;c++)D(s.value[c])===l&&(s.value[c].setMap(null),s.value.splice(c,1),r.value.splice(c,1),c--);i()});let b=document.createElement("button");b.setAttribute("type","button"),b.setAttribute("class","ml-auto mr-2 rounded-xl bg-white px-2 py-1 text-base font-medium text-indigo-600  transition duration-200 hover:text-white hover:bg-indigo-500 active:bg-indigo-600 border border-indigo-600"),b.setAttribute("style","transform: rotate(90deg)"),b.appendChild(document.createTextNode("<")),b.addEventListener("click",function(){for(var n=0;n<s.value.length;n++)if(D(s.value[n])===l){if(n==0)return;let c=this.parentNode.parentNode;document.getElementById("plan-list").insertBefore(c,c.previousSibling);let T=s.value[n-1];s.value[n-1]=s.value[n],s.value[n]=T;let P=r.value[n-1];r.value[n-1]=r.value[n],r.value[n]=P;break}i()});let y=document.createElement("button");y.setAttribute("type","button"),y.setAttribute("class","mr-2 rounded-xl bg-white px-2 py-1 text-base font-medium text-indigo-600 transition duration-200 hover:text-white hover:bg-indigo-500 active:bg-indigo-600 border border-indigo-600"),y.setAttribute("style","transform: rotate(90deg)"),y.appendChild(document.createTextNode(">")),y.addEventListener("click",function(){for(var n=0;n<s.value.length;n++)if(D(s.value[n])===l){if(n==s.value.length-1)return;let c=this.parentNode.parentNode.nextSibling;document.getElementById("plan-list").insertBefore(c,c.previousSibling);let T=s.value[n+1];s.value[n+1]=s.value[n],s.value[n]=T;let P=r.value[n+1];r.value[n+1]=r.value[n],r.value[n]=P;break}i()}),m.appendChild(h),m.appendChild(b),m.appendChild(y),m.appendChild(x),g.appendChild(m),o.appendChild(g)};var _=null;function i(){_!=null&&_.setMap(null);const e=d([]);for(let t=0;t<r.value.length;t++)e.value.push(r.value[t]);_=new kakao.maps.Polyline({path:e.value,strokeWeight:5,strokeColor:"#2D64F5",strokeOpacity:.7,strokeStyle:"solid"}),_.setMap(p)}return(e,t)=>(C(),I("div",Y))}},ee=a("div",{class:"my-5 text-center font-semibold text-xl"},"여행 계획",-1),te={class:"grid grid-cols-4"},ae={class:"col-span-3"},le={class:"fluid-container text-center mt-3 mr-[100px] ml-auto w-9/12"},ne={class:"flex items-center justify-center mb-10"},se={class:"mx-auto"},oe={class:"flex"},ie={class:"flex items-center max-w-md mx-auto bg-white rounded-lg","x-data":"{ search: '' }"},re={class:"w-full"},de=a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),ue=[de],ce={key:0,class:"my-5"},pe={key:1,class:"bg-white my-5"},ve={class:"overflow-x-auto border-x border-t scrollbar",style:{width:"100%",height:"500px",overflow:"auto"}},me={class:"table-auto w-full"},he=a("thead",{class:"border-b"},[a("tr",{class:"bg-emerald-500 text-white"},[a("th",{class:"text-center p-4 font-medium"},"대표이미지"),a("th",{class:"text-center p-4 font-medium"},"관광지명"),a("th",{class:"text-center p-4 font-medium"},"주소")])],-1),ge={class:"overflow-y-scroll w-full"},fe=["onClick"],be={class:"p-2",style:{width:"100px"}},ke=["src"],xe={class:"p-3",style:{width:"200px"}},we={class:"p-3",style:{width:"300px"}},_e={class:"col-span-1 mr-auto ml-10"},ye={class:"mr-14 mt-5"},Le=a("button",{class:"bg-white text-emerald-600 font-semibold py-2 px-4 border border-emerald-600 rounded-md shadow-md hover:bg-emerald-600 hover:text-white focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-opacity-50",id:"tripPlanSaveBtn"}," 저장하기 ",-1),Ce={class:"my-5"},Ie={for:"date"},Ee=a("div",{id:"plan-list",class:"mt-3"},null,-1),Me={__name:"TripPlan",setup(j){const p=W(),w=d([]),v=d([]),u=d({}),k=d([{text:"관광지 유형",value:0},{text:"관광지",value:12},{text:"문화시설",value:14},{text:"축제공연행사",value:15},{text:"여행코스",value:25},{text:"레포츠",value:28},{text:"숙박",value:32},{text:"쇼핑",value:38},{text:"음식점",value:39}]),s=d({sidoCode:0,contentTypeId:0,keyword:""}),r=d(null),f=d(null);U(()=>{sessionStorage.getItem("userId")==null&&(L.fire("로그인이 필요한 페이지입니다!"),p.push({name:"user-login"})),E(),document.getElementById("tripPlanSaveBtn").addEventListener("click",function(){let e=document.getElementsByName("plan-list-item");const t=d([]);for(let o=0;o<e.length;o++){let g=e[o].getAttribute("data-content-id");console.log(g),t.value.push(g)}const l=d({userId:sessionStorage.getItem("userId"),startDate:r.value,endDate:f.value,planList:t.value,comment:""});L.fire({title:"여행 제목을 입력하세요",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"확인",cancelButtonText:"취소",showLoaderOnConfirm:!0,preConfirm:async o=>(o?l.value.comment=o:L.showValidationMessage("여행 제목을 입력해야 합니다."),o),allowOutsideClick:()=>!L.isLoading()}).then(o=>{o.isConfirmed&&o.value&&_(l.value)})})});const E=()=>{q(({data:i})=>{let e=[];e.push({text:"시도선택",value:""}),i.forEach(t=>{e.push({text:t.sidoName,value:t.sidoCode})}),w.value=e},i=>{console.log(i)})},S=i=>{s.value.sidoCode=i},B=i=>{s.value.contentTypeId=i},M=()=>{Q(s.value,({data:i})=>{v.value=i},i=>{console.log(i)})},A=i=>{u.value=i},_=i=>{G(i,e=>{let t=e.data;e.status===X.OK?(t="계획을 저장했습니다.",L.fire({text:t,icon:"success"}),p.push({name:"trip-planList"})):L.fire({icon:"error",text:t})},e=>{console.error(e)})};return(i,e)=>(C(),I(F,null,[ee,a("div",te,[a("div",ae,[a("div",le,[a("div",ne,[a("div",se,[a("form",oe,[N(K,{selectOption:w.value,onOnKeySelect:S},null,8,["selectOption"]),N(K,{selectOption:k.value,onOnKeySelect:B},null,8,["selectOption"]),a("div",ie,[a("div",re,[O(a("input",{type:"search",class:"w-full px-4 py-1 text-gray-800 rounded-full focus:outline-none","onUpdate:modelValue":e[0]||(e[0]=t=>s.value.keyword=t),placeholder:"search","x-model":"search"},null,512),[[V,s.value.keyword]])]),a("div",null,[a("button",{class:"flex items-center bg-emerald-500 justify-center w-12 h-12 text-white rounded-r-lg",type:"button",onClick:M},ue)])])])])]),N(Z,{stations:v.value,selectStation:u.value},null,8,["stations","selectStation"]),v.value.length===0?(C(),I("div",ce)):(C(),I("div",pe,[a("div",ve,[a("table",me,[he,a("tbody",ge,[(C(!0),I(F,null,H(v.value,t=>(C(),I("tr",{class:"text-center border-b hover:bg-gray-50",key:t.contentId,onClick:l=>A(t)},[a("td",be,[a("img",{src:t.firstImage},null,8,ke)]),a("td",xe,$(t.title),1),a("td",we,$(t.addr1)+" "+$(t.addr2),1)],8,fe))),128))])])])]))])]),a("div",_e,[a("div",ye,[Le,a("div",Ce,[a("label",Ie,[O(a("input",{type:"date",id:"startDate","onUpdate:modelValue":e[1]||(e[1]=t=>r.value=t)},null,512),[[V,r.value]]),J(" ~ "),O(a("input",{type:"date",id:"endDate","onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t)},null,512),[[V,f.value]])])]),Ee])])])],64))}};export{Me as default};
